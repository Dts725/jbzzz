<template>
  <div class="app-container">
  	<a href="https://file.shyunhua.com/jbhfile/上传统一格式.xlsx" class="moban">模板导入下载</a>
  	<a :href="'http://jbh.shyunhua.com/user_export?examine_status=1&organization_id='+this.topBar2[2].selected[0]+'.html'" class="daochu">批量导出</a>
  	<!--<el-button type="primary" size="small" class="qingchu" @click='qingchu()'>清除</el-button>-->
    <list :url="URL+url" :update="update" :topBar="topBar" :topBar2="topBar2" :canSelect="canSelect" :indexBar="indexBar"
          :thead="thead"
          :actionBar="actionBar"></list>
      <!-- <div id="fileExport">
        <world :detail-data="detailData"><world>
      </div> -->
    <!-- 弹出框 -->
    <el-dialog :title="dialogTitle" :dialogType="dialogType" :visible.sync="showDialog" center top="15vh">
      <el-form :model="addForm" ref="addForm" label-width="100px" class="demo-ruleForm">
        <!--<el-form :model="addForm" :rules="rules" ref="addForm" label-width="100px" class="demo-ruleForm">-->
        <!--<el-row :gutter="20">-->
        <el-row>
          <el-col :span="12">
            <el-form-item label="姓名" prop="user_name">
              <el-input size="medium" v-model="addForm.user_name" :disabled="dialogType=='edit'"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="性别" prop="user_sex">
              <el-radio-group v-model="addForm.user_sex">
                <el-radio label="男"></el-radio>
                <el-radio label="女"></el-radio>
              </el-radio-group>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="民族" prop="user_nation">
              <el-input size="medium" v-model="addForm.user_nation"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="出生日期" prop="user_birth">
              <el-date-picker
                v-model="addForm.user_birth"
                type="datetime"
                size="medium"
                format="yyyy - MM - dd"
                @change="formatTime(addForm.user_birth, 'user_birth')"
                placeholder="选择日期时间">
              </el-date-picker>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="身份证" prop="user_card">
              <el-input size="medium" v-model="addForm.user_card"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="学历" prop="user_education">
              <el-input size="medium" v-model="addForm.user_education"></el-input>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="家庭住址" prop="user_address">
              <el-input size="medium" v-model="addForm.user_address"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="联系电话" prop="user_phone">
              <el-input size="medium" v-model="addForm.user_phone"></el-input>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="入党日期" prop="user_in_date">
              <el-date-picker
                v-model="addForm.user_in_date"
                type="datetime"
                size="medium"
                format="yyyy - MM - dd"
                @change="formatTime(addForm.user_in_date,'user_in_date')"
                placeholder="选择日期时间">
              </el-date-picker>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="转正日期" prop="user_become_date">
              <el-date-picker
                v-model="addForm.user_become_date"
                type="datetime"
                size="medium"
                format="yyyy - MM - dd"
                @change="formatTime(addForm.user_become_date,'user_become_date')"
                placeholder="选择日期时间">
              </el-date-picker>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="派出单位" prop="user_dispatched_unit">
              <el-input size="medium" v-model="addForm.user_dispatched_unit"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="原单位" prop="user_origin_unit">
              <el-input size="medium" v-model="addForm.user_origin_unit"></el-input>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="原单位所在党组织" prop="user_origin_organization_name">
              <el-input size="medium" v-model="addForm.user_origin_organization_name"></el-input>
              <!--<el-select size="medium" v-model="addForm.user_origin_organization_name" placeholder="请选择党组织">-->
              <!--<el-option v-for="com in organizationList" :key="com.id" :label="com.organization_name"-->
              <!--:value="String(com.id)">-->
              <!--</el-option>-->
              <!--</el-select>-->
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="保障组别" prop="user_temp_team">
              <!--<el-input size="medium" v-model="addForm.user_temp_team"></el-input>-->
             <!-- {{typeof addForm.user_temp_team}}-->
               <el-select v-model="addForm.user_temp_team" placeholder="请选择党组织">
	              <el-option
							      v-for="item in organizationList1"
							      :key="item.id"
							      :label="item.user_temp_team"
							      :value="item.id">

							    </el-option>
						    </el-select>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="12">
            <el-form-item label="现所在临时党组织" prop="user_organization_id" v-if="dialogType=='new'">
            <!-- <el-input size="medium" v-model="addForm.user_organization_id" placeholder="请选择党组织" ></el-input>-->
            <!--<el-select size="medium" v-model="addForm.user_organization_id" placeholder="请选择党组织">-->
              <!--<el-select size="medium" v-model="addForm.user_organization_id" placeholder="请选择党组织"-->
                         <!--:disabled="dialogType=='edit'">-->
                <!--<el-option v-for="com in organizationList" :key="com.id" :label="com.organization_name"
                           :value="String(com.id)">
                </el-option>-->
              <!--</el-select>-->
              <el-tree :check-strictly='true' :data="data" show-checkbox=""  :default-expand-all="true" node-key="id" ref="treeForm" highlight-current :props="defaultProps" @check-change="handleClick" :default-checked-keys='keys' v-if='username1=="admin"'>
							</el-tree>
							<el-input size="medium" v-model="name" :disabled='true' v-if='username1!="admin"'></el-input>
							<!--<el-input size="medium" v-model="addForm.user_organization_id" :disabled='true' v-if="dialogType=='edit'"></el-input>-->
            </el-form-item>
          </el-col>
          <el-col :span="12" v-if="dialogType=='edit'">
            <el-form-item label="现所在临时党组织" prop="organization_name">
							<el-input size="medium" v-model="addForm.organization_name" :disabled='true' ></el-input>
            </el-form-item>

          </el-col>
          <el-col :span="12">
            <el-form-item label="党内职务" prop="user_job">
              <!--<el-input size="medium" v-model="addForm.user_job"></el-input>-->
              <!--<el-select size="medium" v-model="addForm.user_job" placeholder="请选择党组织" >
                  <el-option label="书记"></el-option>
                  <el-option label="副书记"></el-option>
                  <el-option label="委员"></el-option>
                  <el-option label="党员"></el-option>
              </el-select>-->
              <el-select v-model="addForm.user_job" placeholder="请选择党组织">
						    <el-option
						      v-for="item in options"
						      :key="item.value"
						      :label="item.label"
						      :value="item.value">
						    </el-option>
						  </el-select>
            </el-form-item>
          </el-col>
        </el-row>
				<el-row v-if='dialogType=="edit"'>
          <el-col :span="24">
            <el-form-item label="所参加的活动">
              <!--<span>{{huodong}}</span>-->
              <el-input v-model="huodong" :disabled='true'></el-input>
            </el-form-item>

          </el-col>
        </el-row>
        <!--<el-form-item label="设置社区" prop="communitySelect" v-if="username=='admin'">-->
        <!--<el-select size="medium" v-model="addForm.communitySelect" placeholder="请选择社区">-->
        <!--<el-option v-for="com in communityList" :key="com.id" :label="com.community_name"-->
        <!--:value="com.id">-->
        <!--</el-option>-->
        <!--</el-select>-->
        <!--</el-form-item>-->

        <el-form-item class="align-right">
          <el-button type="primary" @click="submitAddForm('addForm', dialogType)">确定</el-button>
          <el-button @click="resetAddForm('addForm')">取消</el-button>
        </el-form-item>
      </el-form>
    </el-dialog>
     <el-dialog :title="dialogTitle" :visible.sync="showDialog1" center top="5vh" width="60%">
      <el-form :model="addForm" ref="addForm" label-width="135px" class="demo-ruleForm">
        <el-button class="file-out" size="medium" type="primary" @click="_fileOut()">导出</el-button>
        <!-- 基本情况 -->
        <div class="review-box info">
          <div class="review-title">
            <div class="review-left">
              <i class="fa fa-id-card"></i>
              <span>基本情况</span>
            </div>
            <div class="review-right">
              <!--<i class="fa fa-plus" @click="EventAdd"></i>-->
            </div>
          </div>
          <el-row>
            <el-col :span="14">
              <el-row>
                <el-col :span="12">
                  <el-form-item label="姓名" prop="user_name">
                    <el-input size="medium" v-model="addForm.user_name" :disabled="true"></el-input>
                  </el-form-item>
                </el-col>
                <el-col :span="12">
                  <el-form-item label="性别" prop="user_sex">
                    <el-radio-group v-model="addForm.user_sex">
                      <el-radio label="男"></el-radio>
                      <el-radio label="女"></el-radio>
                    </el-radio-group>
                  </el-form-item>
                </el-col>
              </el-row>
            </el-col>
            <el-col :span="10">
              <el-form-item label="出生日期" prop="user_birth">
                <el-date-picker
                  v-model="addForm.user_birth"
                  type="datetime"
                  @change="formatTime(addForm.user_birth, 'user_birth')"
                  format="yyyy - MM - dd"
                  placeholder="选择日期时间" :disabled="true">
                </el-date-picker>
              </el-form-item>
            </el-col>

          </el-row>


          <el-row>
            <el-col :span="14">
              <el-form-item label="原单位" prop="user_origin_unit">
                <el-input size="medium" v-model="addForm.user_origin_unit" :disabled="true"></el-input>
              </el-form-item>
            </el-col>
            <el-col :span="10">
              <el-form-item label="派出单位" prop="user_dispatched_unit">
                <el-input size="medium" v-model="addForm.user_dispatched_unit" :disabled="true"></el-input>
              </el-form-item>
            </el-col>
          </el-row>

          <el-row>
            <el-col :span="14">
              <el-form-item label="原单位所在党组织" prop="user_origin_organization_name">
                <el-input size="medium" v-model="addForm.user_origin_organization_name" :disabled="true"></el-input>
              </el-form-item>
            </el-col>
            <el-col :span="10">
              <el-form-item label="保障组别" prop="user_temp_team">
                <!--<el-input size="medium" v-model="addForm.user_temp_team" :disabled="true"></el-input>-->
                <el-select v-model="addForm.user_temp_team" placeholder="请选择党组织" :disabled="true">
	              <el-option
							      v-for="item in organizationList1"
							      :key="item.id"
							      :label="item.user_temp_team"
							      :value="item.id">
							    </el-option>
						    </el-select>
              </el-form-item>
            </el-col>
          </el-row>

          <el-row>
            <el-col :span="14">
              <!--<el-form-item label="现所在临时党组织" prop="user_organization_id">-->
                <!--<el-input size="medium" v-model="addForm.user_organization_id" ></el-input>-->
                <!--<el-select size="medium" v-model="addForm.user_organization_id" placeholder="请选择党组织">
                  <el-option v-for="com in organizationList" :key="com.id" :label="com.organization_name"
                             :value="String(com.id)">
                  </el-option>
                </el-select>
              </el-form-item>-->
              <el-form-item label="现所在临时党组织" prop="organization_name">
                <!--<el-input size="medium" v-model="addForm.user_organization_id" ></el-input>-->
                <el-select size="medium" v-model="addForm.organization_name" placeholder="请选择党组织">
                  <el-option v-for="com in organizationList" :key="com.id" :label="com.organization_name"
                             :value="String(com.id)" :disabled="true">
                  </el-option>
                </el-select>
              </el-form-item>

            </el-col>
            <!--<el-col :span="10">
              <el-form-item label="党内职务" prop="user_job">
                <!--<el-input size="medium" v-model="addForm.user_job"></el-input>-->
              <!--</el-form-item>
            </el-col>-->
            <el-col :span="10">
              <el-form-item label="党内职务" prop="user_job">
                <!--<el-input size="medium" v-model="addForm.user_job"></el-input>-->
                <!--<el-select size="medium" v-model="addForm.user_job" placeholder="党内职务">
                  <el-option label="党总支" value="1"></el-option>
                  <el-option label="党支部" value="2"></el-option>
                </el-select>-->
                <el-select v-model="addForm.user_job" placeholder="请选择党组织" :disabled="true">
						    <el-option
						      v-for="item in options"
						      :key="item.value"
						      :label="item.label"
						      :value="item.value">
						    </el-option>
						  </el-select>
              </el-form-item>
            </el-col>
          </el-row>


          <el-row>
            <el-col :span="14">
              <el-form-item label="进保障组时间" prop="user_temp_in_date">
                <el-date-picker
                  v-model="addForm.user_temp_in_date"
                  type="datetime"
                  format="yyyy - MM - dd"
                  @change="formatTime(addForm.user_temp_in_date,'user_temp_in_date')"
                  placeholder="选择日期时间">
                </el-date-picker>
              </el-form-item>
            </el-col>
            <el-col :span="10">
              <el-form-item label="出保障组时间" prop="user_temp_out_date">
                <el-date-picker
                  v-model="addForm.user_temp_out_date"
                  type="datetime"
                  format="yyyy - MM - dd"
                  @change="formatTime(addForm.user_temp_out_date,'user_temp_out_date')"
                  placeholder="选择日期时间">
                </el-date-picker>
              </el-form-item>
            </el-col>
          </el-row>
        </div>

        <!-- 关键事件记录 -->
        <div class="review-box event">
          <div class="review-title">
            <div class="review-left">
              <i class="fa fa-bookmark-o"></i>
              <span>关键事件记录</span>
            </div>
            <!--<p style="font-size:0.9rem;color:#888;margin:0;font-weight:normal;">新增或修改后记得在页面底部点击 <strong>确定保存</strong> 按钮</p>-->
            <div class="review-right" @click="EventAddEdit('new','','')">
              <i class="fa fa-plus"></i>
              <span>新增</span>
            </div>
          </div>
          <ul class="event-list">
            <li v-for="(hs,idx) in EventTempInfo.history" :key="hs.id" @mouseenter="mouseenter(hs,this)"
                @mouseleave="mouseleave(hs,this)">
              <div class="event-title">
                <div class="event-title-left">
                  <p><strong>时间：</strong>{{dateformat.format(new Date(hs.date), 'yyyy - MM - dd')}}</p>
                  <p><strong>记录人：</strong>{{hs.author}}</p>
                </div>
                <span class="event-icons" v-show="hs.showIcon">
                  <i class="fa fa-edit" @click="EventAddEdit('edit', hs, idx)"></i>
                  <i class="fa fa-trash-o" @click="EventDel(hs, idx)"></i>
                </span>
              </div>
              <div class="event-con">
                <strong>事件：</strong>
                <p>{{hs.event}}</p>
              </div>
            </li>

            <!--<li>-->
            <!--<div class="event-title">-->
            <!--<div class="event-title-left">-->
            <!--<p><strong>时间：</strong>2018-11-31</p>-->
            <!--<p><strong>记录人：</strong>张三</p>-->
            <!--</div>-->
            <!--<s class="event-icons">-->
            <!--<i class="fa fa-arrow-up"></i>-->
            <!--<i class="fa fa-arrow-up"></i>-->
            <!--</s>-->
            <!--</div>-->
            <!--<div class="event-con">-->
            <!--<strong>事件：</strong>-->
            <!--<p>jwpgjpowjegpojoiasdoifgjiowjegioj结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒 叫我额估计结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒-->
            <!--叫我额估计结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒 叫我额估计结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒 叫我额估计结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒-->
            <!--叫我额估计结果我哦忘记哦诶过奇偶较为欧冠奇偶我我鸡尾酒 叫我额估计</p>-->
            <!--</div>-->
            <!--</li>-->
          </ul>
          <div class="event-add" v-show="EventTempInfo.history.length==0 || EventTempInfo.show">
            <div class="event-add-top">
              <p>
                <strong>时间</strong>
                <!--<el-input size="small" v-model="EventTempInfo.date" :disabled="true"></el-input>-->
                <el-date-picker
                  size="small"
                  v-model="EventTempInfo.date"
                  type="datetime"
                  @change="formatTime(EventTempInfo.date, 'events', 'date')"
                  placeholder="选择日期时间">
                </el-date-picker>
              </p>
              <p>
                <strong>记录人</strong>
                <el-input size="small" v-model="EventTempInfo.author"></el-input>
              </p>
              <p style="float:right;">
                <el-button size="small" style="background-color: #e6a23c; color:#fff; margin-right:1rem;"
                           @click="submitEventAdd">保存
                </el-button>
              </p>
            </div>
            <div class="event-add-con">
              <strong>事件</strong>
              <el-input type="textarea" :autosize="{ minRows: 4}" v-model="EventTempInfo.event"></el-input>
            </div>
          </div>

        </div>


        <!-- 个人小结 -->
        <div class="review-box Summary">
          <div class="review-title">
            <div class="review-left">
              <i class="fa fa-tags"></i>
              <span>个人小结</span>
            </div>
            <div class="review-right">
              <!--<i class="fa fa-plus" @click="EventAdd"></i>-->
            </div>
          </div>
          <el-input type="textarea" :autosize="{ minRows: 6}" v-model="examine.examine_summarize"></el-input>
        </div>


        <!-- 评价 -->
        <div class="review-box Summary">
          <div class="review-title">
            <div class="review-left">
              <i class="fa fa-user-o"></i>
              <span>评价</span>
            </div>
            <div class="review-right">
              <!--<i class="fa fa-plus" @click="EventAdd"></i>-->
            </div>
          </div>
          <el-input type="textarea" :autosize="{ minRows: 6}" v-model="examine.examine_assess"></el-input>

        </div>
        <!--</div>-->


        <el-form-item class="align-right">
          <el-button type="primary" @click="submitAddForm1('addForm', dialogType1)">确定保存</el-button>
          <el-button @click="resetAddForm('addForm')">取消</el-button>
        </el-form-item>
      </el-form>
    </el-dialog>

     <!--<el-dialog title="详情" :visible.sync="showDetailDialog" center top="5vh" width="60%">
      <el-button class="file-out" size="medium" type="primary" @click="_fileOut()">导出</el-button>-->
      <div id="fileExport" style="visibility: hidden;">
        <!--<div class="review-title">-->
        <!--<div class="review-left">-->
        <!--<i class="fa fa-id-card"></i>-->
        <!--<span>基本情况</span>-->
        <!--</div>-->
        <!--<div class="review-right">-->
        <!--&lt;!&ndash;<i class="fa fa-plus" @click="EventAdd"></i>&ndash;&gt;-->
        <!--</div>-->
        <!--</div>-->
        <!--<strong>姓名:</strong>{{addForm.user_name}}-->
        <table style="border-collapse: collapse; text-align:center;width:100%;" >
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; color:#f00;background-color:#f3d19e;" colspan="4"><strong>党员综合评价表</strong>
            </td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>姓名</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_name}}</td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>姓别</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_sex}}</td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>原单位</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_origin_unit}}</td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>出生日期</strong></td>
            <!--<td style="border:1px solid #666; padding:0.5rem;width:500px;" >{{detailData.user_birth}}</td>-->
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">
              {{detailData.user_birth&&detailData.user_birth.length>9?dateformat.format(new
              Date(isNaN(Number(detailData.user_birth))?detailData.user_birth:Number(detailData.user_birth)),
              'yyyy-MM-dd'):''}}
            </td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>派出单位</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_dispatched_unit}}</td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>党内职务</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_job}}</td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>原单位所在党组织</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">
              {{detailData.user_origin_organization_name}}
            </td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>保障组别</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.user_temp_team_name}}</td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>现所在临时党组织</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">{{detailData.organization_name}}</td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>进保障组时间</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">
              {{detailData.user_temp_in_date&&detailData.user_temp_in_date.length>9?dateformat.format(new
              Date(Number(detailData.user_temp_in_date)), 'yyyy-MM-dd'):''}}
            </td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>出保障组时间</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">
              {{detailData.user_temp_out_date&&detailData.user_temp_out_date.length>9?dateformat.format(new
              Date(Number(detailData.user_temp_out_date)), 'yyyy-MM-dd'):''}}
            </td>
            <td style="border:1px solid #666; padding:0.5rem; width:300px;"><strong>考评日期</strong></td>
            <td style="border:1px solid #666; padding:0.5rem;width:500px;">
              {{detailData.examine_date&&detailData.examine_date.length>9?dateformat.format(new
              Date(Number(detailData.examine_date)), 'yyyy-MM-dd'):''}}
            </td>
          </tr>

          <tr v-if="EventTempInfo.history.length>0">
            <td style="border:1px solid #666; padding:0.5rem;color:#f00;background-color:#f3d19e;" colspan="4"><strong>关键事件记录</strong>
            </td>
          </tr>
          <!--<tr>-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:300px;" ><strong>时间</strong></td>-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:300px;" ><strong>记录人</strong></td>-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:500px;" colspan="2"><strong>事件</strong></td>-->
          <!--</tr>-->
          <!--<tr v-for="(hs,idx) in EventTempInfo.history" :key="hs.id" v-if="EventTempInfo.history.length>0">-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:300px;" >{{dateformat.format(new Date(hs.date), 'yyyy - MM - dd')}}</td>-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:300px;" >{{hs.author}}</td>-->
          <!--<td style="border:1px solid #666; padding:0.5rem;width:500px;text-align:left;" colspan="2">{{hs.event}}</td>-->
          <!--</tr>-->
          <tr v-for="(hs,idx) in EventTempInfo.history" :key="hs.id" v-if="EventTempInfo.history.length>0">
            <td style="border:1px solid #666; padding:0.5rem;width:500px; text-align:left;" colspan="4">
              <div style="margin-bottom:10px;"><strong>时间：</strong>{{dateformat.format(new Date(hs.date),
                'yyyy-MM-dd')}} <strong style="margin-left:30px;">记录人：</strong>{{hs.author}}
              </div>
              <div>{{hs.event}}</div>
            </td>
          </tr>
          <tr v-else>
            <td style="border:1px solid #666; padding:0.5rem;" colspan="4">暂无</td>
          </tr>

          <tr>
            <td style="border:1px solid #666; padding:0.5rem; color:#f00;background-color:#f3d19e;" colspan="4"><strong>个人小结</strong>
            </td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem;width:500px; text-align:left;" colspan="4">
              {{detailData.examine_summarize}}
            </td>
          </tr>

          <tr>
            <td style="border:1px solid #666; padding:0.5rem; color:#f00;background-color:#f3d19e;" colspan="4"><strong>评价</strong>
            </td>
          </tr>
          <tr>
            <td style="border:1px solid #666; padding:0.5rem;width:500px; text-align:left;" colspan="4">
              {{detailData.examine_assess}}
            </td>
          </tr>
        </table>
      </div>

   <!-- </el-dialog>-->


   <!-- {{shaixuan}}-->
  </div>
</template>

<script>
  // import {getList2, getDetail} from '@/api/member';
  import http from '@/api/http';
  import list from '@/components/TableList';
  import {Message, MessageBox} from 'element-ui'
  import Vue from 'vue';
  import $ from '../../utils/fileExport/jqueryExport';
  import saveAs from '../../utils/fileExport/filesaverExport';
  import '../../utils/fileExport/jquery.wordexport';
  import world from '@/components/World/World';

//	import $ from '../../utils/jqueryExport';
//	import '../../utils/fileExport/jquery.wordexport';
//	import '../../utils/fileExport/W.excelexport';

  export default {
    components: {
      list,
      world
    },
    data() {
      return {
      	huodong:'',
      	zhou:["ww","ss"],
      	shaixuan:[{id:1,value:'aaa'}],
      	showDetailDialog: false,
      	detailData: {},
      	options: [{
          value: '1',
          label: '书记'
        }, {
          value: '2',
          label: '副书记'
        }, {
          value: '3',
          label: '委员'
        }, {
          value: '4',
          label: '党员'
        }],
        value: '',
      	keys:[],
      	i:0,
      	arr1:[],
      	daochu:133,
      	organizationList1:[],
        /** *************** 引用的表格的  start *************** **/
        listLoading: true,
        // 列表头部的功能区--key为搜索的字段名
        // topBar: {
        //   useNewBtn: {btnName: '新增', btnClass: '', btnType: 'success', keys: [], fun: this.newRole},
        //   useSearch: {key: 'user_name', btnName: '搜索', searchTipCon: '请输入名字'}
        // },
        topBar: [
          {name: '新增', type: 'success', class: '', fun: this.newRole},
          {
            name: '导入',
            type: 'primary',
            isUpLoad: true,
            url: 'https://jbh.shyunhua.com/user_import',
            maxSize: '',
            limit: 100,
            showList: false,
            fun: this.importData
          },
//
          {name: '搜索', key: 'user_name', searchTipCon: '请输入名字', class: '',options:[]},
//        {
//          name: '保障组别筛选',
//          key: 'user_temp_team',
//          plugType: 'cascader',
//          dataUrl: this.URL + '/user',
//          searchTipCon: '保障组别筛选',
//          selected: [],
//          class: '',
//          options: [{
//            value: 'zhinan',
//            label: '指南',
//            children: [{
//              value: 'shejiyuanze',
//              label: '设计原则',
//              children: [{
//                value: 'yizhi',
//                label: '一致'
//              }, {
//                value: 'fankui',
//                label: '反馈'
//              }, {
//                value: 'xiaolv',
//                label: '效率'
//              }, {
//                value: 'kekong',
//                label: '可控'
//              }]
//            }]
//          }, {
//            value: 'zhinan2',
//            label: '指南2',
//          }
//          ]
//        },
//					{
//          name: '保障组别筛选',
//          key: 'user_temp_team',
//          plugType: 'cascader',
//          //dataUrl: this.URL + '/user',
//          searchTipCon: '保障组别筛选',
//          selected: [],
//          class: '',
////          options:this.fffff,
//						options:[]
//        },
//
//        {
//          name: '党内职务筛选',
////          width:'100',
//          key: 'user_job',
//          plugType: 'cascader',
//          searchTipCon: '党内职务筛选',
//          selected: [],
//          class: '',
//          options: [
//            {id: 1, value: '书记'},
//            {id: 2, value: '副书记'},
//            {id: 3, value: '委员'},
//            {id: 4, value: '党员'},
//            // {value: 1, label: '书记'},
//            // {value: 2, label: '副书记'},
//            // {value: 3, label: '委员'},
//            // {value: 4, label: '党员'},
//          ]
//        },
//        {
//          name: '党组织筛选',
//          key: 'organization_id',
//          plugType: 'cascader',
//          //dataUrl: this.URL + '/user',
//          searchTipCon: '党组织筛选',
//          selected: [],
//          class: '',
////          options:this.fffff,
//						options:[]
//        },
////           {
////             name: '党组织筛选',
////             key: 'organization_id',
////             plugType: 'cascader',
////             dataUrl: this.URL + '/organization',
////             searchTipCon: '党组织筛选',
////             class: ''
////           },
//        {
//          name: '状态筛选',
//          key: 'user_status',
//          plugType: 'cascader',
//          searchTipCon: '状态筛选',
//          selected: [],
//          class: '',
//          options: [
//            {id: 1, value: '在岗'},
//            {id: 2, value: '已离岗'},
////            {id: 3, value: '已删除'},
//          ]
//        },
//        {
//          name: '评价筛选',
//          key: 'examine_status',
//          plugType: 'cascader',
//          searchTipCon: '评价筛选',
//          selected: [],
//          class: '',
//          options: [
//            {id: 0, value: '未评价'},
//            {id: 1, value: '已评价'},
////            {id: 3, value: '已删除'},
//          ]
//        },
//
      ],
      topBar2: [
          {
            name: '保障组别筛选',
            key: 'user_temp_team',
            plugType: 'cascader',
            //dataUrl: this.URL + '/user',
            searchTipCon: '保障组别筛选',
            selected: [],
            class: '',
//          options:this.fffff,
            options: []
          },
          {
            name: '党内职务筛选',
//          width:'100',
            key: 'user_job',
            plugType: 'cascader',
            searchTipCon: '党内职务筛选',
            selected: [],
            class: '',
            options: [
              {id: 1, value: '书记'},
              {id: 2, value: '副书记'},
              {id: 3, value: '委员'},
              {id: 4, value: '党员'},
            ]
          },
          {
            name: '党组织筛选',
            key: 'organization_id',
            plugType: 'cascader',
            //dataUrl: this.URL + '/user',
            searchTipCon: '党组织筛选',
            selected: [],
            class: '',
//          options:this.fffff,
            options: []
          },
          {
            name: '状态筛选',
            key: 'user_status',
            plugType: 'cascader',
            searchTipCon: '状态筛选',
            selected: [],
            class: '',
            options: [
              {id: 1, value: '在岗'},
              {id: 2, value: '已离岗'},
//            {id: 3, value: '已删除'},
            ]
          },
          {
            name: '评价筛选',
            key: 'examine_status',
            plugType: 'cascader',
            searchTipCon: '评价筛选',
            selected: [],
            class: '',
            options: [
              {id: 0, value: '未评价'},
              {id: 1, value: '已评价'},
//            {id: 3, value: '已删除'},
            ]
          },
					{name: '清除', fun: this.qingchu, type: 'primary'},

        ],
        // 表格头- 是否可选
        canSelect: false,
        // 表格头- 索引序号
        indexBar: {name: '序号', key: 'auto', width: '80'},
        // 表格头 - 字段内容
        thead: [
          // {name: '账号名称', key: 'username', width: ''},
          // {name: '所属社区', key: 'community_name', width: ''},

          {name: "姓名", key: 'user_name', width: '100'},
          {name: "性别", key: 'user_sex', width: '80'},
          // {name: "身份号", key:'aaaaaa', width: '100},
          // {name: "出生日", key:'aaaaaa', width: '100},
          // {name: "学历", key:'aaaaaa', width: '100},
          {name: "联系电话", key: 'user_phone', width: '150'},
          // {name: "入党日期", key:'aaaaaa', width: '100},
          // {name: "转正日期", key:'aaaaaa', width: '100},
          //{name: "派出单位", key:'aaaaaa', width: '100},
          //{name: "原单位", key:'aaaaaa', width: '100},
          //{name: "原职务", key:'aaaaaa', width: '100},
          {name: "保障组别", key: 'user_temp_team_name', width: 'auto'},
          {name: "党内职务", key: 'user_job',
          filterCon: [{key: 1, value: '书记'}, {key: 2, value: '副书记'}, {key: 3, value: '委员'},{key: 4, value: '党员'}],
          width: '120'},
          // {name: "原所在党支部", key:'aaaaaa', width: '100},
          {name: "现所在临时党组织", key: 'user_organization_name',  width: 'auto'},
          {
            name: "状态",
            key: 'user_status',
            filterCon: [{key: 1, value: '在岗'}, {key: 2, value: '离岗'}, {key: 3, value: '离岗'}],
            width: 'auto'
          },
					{
            name: "评价状态",
            key: 'examine_status',
            filterCon: [{key: 0, value: '未评价'}, {key: 1, value: '已评价'}],
            width: 'auto'
          },
        ],
        update: 0, // 手动更新数据，每次接收 +1 的值 如：传 update++
        // 表格头 - 最右边的功能区
        actionBar: [
          {name: '编辑', fun: this.edit, type: 'success'},
          {name: '评价', fun: this.pingjia, type: 'primary'},
          {name: '删除', fun: this.delete, type: 'danger'}
        ],
        /** *************** 引用的表格的  end *************** **/

        /** *************** 弹窗的  start *************** **/
        showDialog: false, //
        dialogTitle: '', // 弹窗标题
        dialogType: '', // 弹窗类型  用来区分新增或编辑
        dialogType1:'',
        showDialog1: false,


        // 新增弹出表单
        addForm: {
          id: '',  // int(11) NOT NULL,
          user_name: '',  // varchar(20) DEFAULT '' COMMENT '姓名',
          user_sex: '',  // varchar(20) DEFAULT NULL COMMENT '性别',

          user_nation: '',  // 民族
          user_birth: '',  // varchar(20) DEFAULT NULL COMMENT '出生日期',

          user_card: '',  // varchar(20) DEFAULT NULL COMMENT '身份证',
          user_education: '',  // varchar(20) DEFAULT NULL COMMENT '学历',

          user_address: '',  // 家庭住址
          user_phone: '',  // varchar(20) DEFAULT NULL COMMENT '联系电话',

          user_in_date: '',  // varchar(20) DEFAULT NULL COMMENT '入党日期',
          user_become_date: '',  // varchar(20) DEFAULT NULL COMMENT '转正日期',

          user_dispatched_unit: '',  // varchar(50) DEFAULT NULL COMMENT '派出单位',
          user_origin_unit: '',  // varchar(50) DEFAULT NULL COMMENT '原单位',

          user_temp_team: '',  // varchar(20) DEFAULT NULL COMMENT '保障组别',
          user_job: '',  // varchar(50) DEFAULT NULL COMMENT '党内职务',

          user_origin_organization_name: '',  // varchar(11) DEFAULT NULL '原党组织id',
//        user_organization_id: '',  // varchar(11) DEFAULT NULL COMMENT '现所在临时党组织id',
					organization_name:'',
          // user_temp_job: '',  // varchar(20) DEFAULT NULL COMMENT '保障组职务',
          user_status: '',  // varchar(3) DEFAULT '1' COMMENT '1未转出 2已转出',

          //     PRIMARY KEY (`id`)
          // ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='党员表';
        },
        // 表单验证规则
        rules: {
          // 名称
          user_name: [
            {required: true, message: '请输入姓名', trigger: 'blur'},
            {min: 2, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur'}
          ],
          // 性别
          user_sex: [
            {required: true, message: '请选择性别', trigger: 'change'}
          ],
          // 身份证
          user_card: [
            {required: true, message: '请输入身份证', trigger: 'blur'}
          ],
          // 出生日期
          user_birth: [
            {required: true, message: '请选择出生日期', trigger: 'blur'}
          ],
          // 学历
          user_education: [
            {required: true, message: '请输入学历', trigger: 'blur'}
          ],
          // 联系电话
          user_phone: [
            {required: true, message: '请输入联系电话', trigger: 'blur'}
          ],
          // 入党日期
          user_in_date: [
            {required: true, message: '请选择入党日期', trigger: 'blur'}
          ],
          // 转正日期
          user_become_date: [
            {required: true, message: '请选择转正日期', trigger: 'blur'}
          ],
          // 派出单位
          user_dispatched_unit: [
            {required: true, message: '请输入派出单位', trigger: 'blur'}
          ],
          // 原单位
          user_origin_unit: [
            {required: true, message: '请输入原单位', trigger: 'blur'}
          ],
          // 职务
          user_job: [
            {required: true, message: '请输入职务', trigger: 'blur'}
          ],
          // 原党组织id
          user_origin_organization_name: [
            {required: true, message: '请选择原党组织', trigger: 'blur'}
          ],
          // 党组织id
          user_organization_id: [
            {required: true, message: '请选择党组织', trigger: 'blur'}
          ],
          // // 保障组职务
          // user_temp_job: [
          //   {required: true, message: '请输入保障组职务', trigger: 'blur'}
          // ],
          // 保障组别
          user_temp_team: [
            {required: true, message: '请输入保障组别', trigger: 'blur'}
          ],
          // 转出状态
          user_status: [
            {required: true, message: '请选择转出状态', trigger: 'blur'}
          ],
          // 家庭住址
          user_address: [
            {required: true, message: '请输入家庭住址', trigger: 'blur'}
          ],
          // 民族
          user_nation: [
            {required: true, message: '请输入民族', trigger: 'blur'}
          ],


          // user_name: '',  // varchar(20) DEFAULT '' COMMENT '姓名',
          // user_sex: '',  // varchar(20) DEFAULT NULL COMMENT '性别',
          // user_card: '',  // varchar(20) DEFAULT NULL COMMENT '身份证',
          // user_birth: '',  // varchar(20) DEFAULT NULL COMMENT '出生日期',
          // user_education: '',  // varchar(20) DEFAULT NULL COMMENT '学历',
          // user_phone: '',  // varchar(20) DEFAULT NULL COMMENT '联系电话',
          // user_in_date: '',  // varchar(20) DEFAULT NULL COMMENT '入党日期',
          // user_become_date: '',  // varchar(20) DEFAULT NULL COMMENT '转正日期',
          // user_dispatched_unit: '',  // varchar(50) DEFAULT NULL COMMENT '派出单位',
          // user_origin_unit: '',  // varchar(50) DEFAULT NULL COMMENT '原单位',
          // user_job: '',  // varchar(50) DEFAULT NULL COMMENT '职务',
          // user_origin_organization_name: '',  // varchar(11) DEFAULT NULL '原党组织id',
          // user_organization_id: '',  // varchar(11) DEFAULT NULL COMMENT '党组织id',
          // user_temp_job: '',  // varchar(20) DEFAULT NULL COMMENT '保障组职务',
          // user_temp_team: '',  // varchar(20) DEFAULT NULL COMMENT '保障组别',
          // user_status: '',  // varchar(3) DEFAULT '1' COMMENT '1未转出 2已转出',
          // user_address: '',  // 家庭住址
          // user_nation: '',  // 民族
        },
        // 党组织列表
        organizationList: [],
        // 社区列表
        communityList: [],
	     examine: {
	      // CREATE TABLE `examine` (
	      id: '', // int(11) NOT NULL AUTO_INCREMENT COMMENT '考评id',
	      user_id: '', // int(11) DEFAULT NULL COMMENT '用户id',
	      examine_summarize: '', // text COMMENT '个人小结',
	      examine_assess: '', // text COMMENT '评价',
	      examine_key: '', // text COMMENT '关键事件',
	      examine_date: '', // varchar(20) DEFAULT NULL COMMENT '考评日期',
	      //     PRIMARY KEY (`id`)
	      // ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COMMENT='考评表';
	      user_organization_id: '', // 现在临时党组织id
				organization_name:'',
	      user_temp_in_date: '',
	      user_temp_out_date: '',
	    },
        /** *************** 弹窗的  end *************** **/
        url: '/user',
        url1:'/examine',

        // 需要转换为时间戳的日期字段
        dateFonts: ['user_birth', 'user_in_date', 'user_become_date'],
        EventTempInfo: {
          show: false,  // 是否显示编辑的面板
          status: '',   // new 或者 edit 的状态
          index: '',    // edit 状态下的索引
          oldData: {},  // 编辑前的数据
          // 关键事件记录
          // events: {
          history: [
            // {
            //   id: 1,
            //   date: 1234567891234,
            //   author: 'admin',
            //   event: '后给我二极管跑挤我碰见过我就告破叫我碰见我今儿个破文件额颇高就我二极管文件的公婆家未破管家婆文件大概看是的估计万科普工接口万科攻破无可个安慰过看',
            //   showIcon: false
            // },
            // {
            //   id: 2,
            //   date: 1234567891234,
            //   author: 'admin2',
            //   event: 'owiejgojvcoiwjfiowjeoifjskdlfjwoiejgf',
            //   showIcon: false
            // },
          ],
          date: '',
          author: '',
          event: '',
          showIcon: false,
          name:'',
          username1:'',
          // }

        },
				data2: [],
        defaultProps: {
          children: 'children',
          label: 'label'
        },
      }

    },
    created() {
      this.init();
      
    },
    activated() {
      this.init();
    },
		computed:{
			data(){
				//debugger;
				let arr=[];
				for(var i=0;i<this.organizationList.length;i++){
					arr.push({
						id:this.organizationList[i].id,
						label:this.organizationList[i].organization_name,
//						children:[],
					});
//					if(this.organizationList[i].child.length>0){
//						for(var j=0;j<this.organizationList[i].child.length;j++){
//									arr[i].children.push({
//				            id:this.organizationList[i].child[j].id,
//				            label:this.organizationList[i].child[j].organization_name,
//
//									});
//						}
//				}
				}
				this.data2 = arr;
				return this.data2;
			},
//			daochu1(){
//				return this.daochu2=this.topBar2[2].selected[0];
//			},
			newUserInfo: {
        get: function () {
          this.examine.user_id = this.addForm.id;
          this.examine.examine_key = JSON.stringify(this.EventTempInfo.history);
          this.examine.examine_date = this.EventTempInfo.status == 'new' ? new Date().getTime() : (this.addForm.examine_date ? this.addForm.examine_date : new Date().getTime());
          // 可修改的三条字段
          this.examine.user_organization_id = this.addForm.user_organization_id;
          this.examine.user_temp_in_date = this.addForm.user_temp_in_date;
          this.examine.user_temp_out_date = this.addForm.user_temp_out_date;
        }
        
    },
//		console.log(this.topBar2[2].selected)
		},
//		computed: {
//    newUserInfo: {
//      get: function () {
//        this.examine.user_id = this.addForm.id;
//        this.examine.examine_key = JSON.stringify(this.EventTempInfo.history);
//        this.examine.examine_date = this.EventTempInfo.status == 'new' ? new Date().getTime() : (this.addForm.examine_date ? this.addForm.examine_date : new Date().getTime());
//        // 可修改的三条字段
//        this.examine.user_organization_id = this.addForm.user_organization_id;
//        this.examine.user_temp_in_date = this.addForm.user_temp_in_date;
//        this.examine.user_temp_out_date = this.addForm.user_temp_out_date;
//      }
//    }
//  },
    methods:{
    	qingchu(){
//  		 console.log(this.$store.state.nav.daochu[0])
//		 console.log(this.topBar2[2].selected[0])
    		this.topBar2[0].selected = [];
    		this.topBar2[1].selected = [];
    		this.topBar2[2].selected = [];
        this.topBar2[3].selected = [];
        this.topBar2[4].selected = [];
        window.location.reload();
        this.topBar2[2].selected
    	},
    	formatRole:function(row,column){
				//debugger;
    		return row.user_job == 1 ? '书记' : (row.user_job ==2 ? '副书记' : (row.user_job ==3 ? '委员' :'党员'));
    	},
      init() {
     
      	//this.reload(),
        // 党组织列表
        http.get('/organization?all=1&organization_status=1').then(res => {
          if (res.code == 0) {
            this.organizationList = res.data.data;
            let arr = [];
            for(var i=0;i<this.organizationList.length;i++){

								arr.push({
									id:this.organizationList[i].id,
									value:this.organizationList[i].organization_name,
								});
					}
//          this.topBar[5].options = arr;
//          this.topBar[5].selected = [];
//
//          this.topBar[4].selected = [];
//          this.topBar[6].selected = [];
						this.topBar2[2].options = arr;
            this.topBar2[2].selected = [];
            this.topBar2[0].selected = [];
		    		this.topBar2[1].selected = [];
		    		this.topBar2[2].selected = [];
		        this.topBar2[3].selected = [];
		        this.topBar2[4].selected = [];
//          this.topBar[4].selected = [];
//          this.topBar[6].selected = [];
//						console.log(this.topBar2[2].selected)
						if(JSON.parse(this.storage.getStorage('uinfo')).username!='admin'){
//								this.topBar[5].hidden=true;
									this.topBar2[2].hidden=true;
		    };
//          debugger;
//          this.shaixuan = arr;
          // console.log(this.shaixuan)
//          let arr=[];
//				for(var i=0;i<this.organizationList;i++){
//					debugger;
//					arr.push({
//						id:this.organizationList[i].id,
//						label:this.organizationList[i].organization_name
//					});
//				}
//				this.data2 = arr;
//				console.log('this.data2:::', this.data2);
          }
        });
				http.get('/user_temp_team').then(res => {
          if (res.code == 0) {
//        	this.addForm.user_temp_team=Number(this.addForm.user_temp_team)
//      	debugger
            this.organizationList1 = res.data;
            for(var i=0;i<this.organizationList1.length;i++){
								this.arr1.push({
									id:this.organizationList1[i].id,
									value:this.organizationList1[i].user_temp_team,
								});
					}
            this.topBar2[0].options = this.arr1;
          }
//        console.log(this.arr1)
        });





        // // 获取社区列表
//         http.get('/community').then(res => {
//           if (res.code == 0) {
//             this.communityList = res.data;
//           }
//         });
//         if (this.storage.getStorage('uinfo').length > 1) {
//           this.community_id = JSON.parse(this.storage.getStorage('uinfo')).community_id;
//           // this.addForm.communitySelect = this.community_id;
//           this.username = JSON.parse(this.storage.getStorage('uinfo')).username;
//         } else {
//           this.community_id = -1;
//           this.disableComm = false;
//         }
          //this.url = this.username == 'admin' ? '/account?type=1' : `/account?type=1&community_id=${this.community_id}`;
//					if (this.storage.getStorage('uinfo').length > 1) {
//           this.community_id = JSON.parse(this.storage.getStorage('uinfo')).id;
//           // this.addForm.communitySelect = this.community_id;
//           this.username = JSON.parse(this.storage.getStorage('uinfo')).username;
//         } else {
//           this.community_id = -1;
//           this.disableComm = false;
//         }
//        this.url = this.username == 'admin' ? '/account?type=1' : `/account?type=1&organization_id=${this.community_id}`;
          //console.log(account?type=1&organization_id=${this.community_id})
          let username = JSON.parse(this.storage.getStorage('uinfo')).username;
          let community_id=JSON.parse(this.storage.getStorage('uinfo')).id;
//        debugger
          this.name=JSON.parse(this.storage.getStorage('uinfo')).name;
          this.username1 = JSON.parse(this.storage.getStorage('uinfo')).username;
          //console.log(user_organization_id)
          this.url = username == 'admin' ? '/user' : `/user?organization_id=${community_id}`;
//        console.log(this.username1)
      },
      mouseenter(obj) {
        obj.showIcon = true;
      },
      mouseleave(obj) {
        obj.showIcon = false;
      },

			handleClick(data,checked, node) {
            this.i++;
            if(this.i%2==0){
                if(checked){
                    this.$refs.treeForm.setCheckedNodes([]);
                    this.$refs.treeForm.setCheckedNodes([data]);
//                  this.addForm =;
//										console.log(data)
                    //交叉点击节点
                }else{
                    this.$refs.treeForm.setCheckedNodes([]);
                    //点击已经选中的节点，置空
                }
            }
        },
      /** 导入数据 **/
      importData(res) {
//    	debugger;
      // console.log('kkkkk')
      
        if(res.code == 0) {
        	Message({
              message: `导入成功`
            });
        }else{
        	Message({
              message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
              type: 'error',
              duration: 1500
            });
        }
      },
      addChange(a,b){
      	//debugger;
      },
      /** 新建 **/
      newRole(e, d) {
        this.showDialog = true;
        this.dialogTitle = '党员信息';
        this.dialogType = 'new';
        this.initForm();
//      console.log(this.data2);
       if(JSON.parse(this.storage.getStorage('uinfo')).username!='admin'){
//     	debugger;
				this.addForm.user_organization_id=JSON.parse(this.storage.getStorage('uinfo')).id;
		    };
      },

       pingjia(e, d) {
//	debugger
        this.searchCon = '';
        this.EventTempInfo.history=[];
				//debugger;
				this.showDialog1=true
				let url2='';
				if(d.examine_status==0){
					this.EventTempInfo.status='new'
					this.dialogType1='new'
					url2=`${this.URL}/user/${d.id}`

				}else if(d.examine_status==1){
					this.dialogType1='edit'
					this.EventTempInfo.status='edit'
//					console.log(this.examine.id)
					url2=`${this.URL}/examine/${d.examine_id}?user_id=${d.id}`
				};
        this.getData(url2,'','get', res => {
          if (res.code == 0) {
          	//debugger;

            // 日期转换为时间戳
            this.addForm = JSON.parse(JSON.stringify(res.data));
//            debugger
            this.detailData = res.data;
            this.detailData.user_job= 1 ? this.detailData.user_job='书记' :(this.detailData.user_job ==2 ? this.detailData.user_job='副书记' : (this.detailData.user_job ==3 ?this.detailData.user_job= '委员':'党员'));

//          this.addForm.active_type== 1 ? this.addForm.active_type='三会一课' : (this.addForm.active_type ==2 ? this.addForm.active_type='主题党日' : (this.addForm.active_type ==3 ?this.addForm.active_type= '关怀帮扶':


//          this.showDetailDialog = true;
            this.addForm = this.dateFontsFiter(this.dateFonts, this.addForm); //格式化时间
            //this.addForm.user_organization_id = String(this.addForm.organization_id);
            this.addForm.organization_name = String(this.addForm.organization_name)

//	          this.addForm.id = res.data.id; //修正form的id
//	    			this.addForm.user_id = res.data.user_id; //修正form的id
//	    			this.addForm.user_id = res.data.id;
        			this.addForm.id = d.id;
//						this.addForm.user_id=String(res.data.user_id);
            this.showDialog1 = true;
            this.dialogTitle = '评价信息';
            //this.dialogType = 'edit';
            this.examine.id=res.data.id;
            this.addForm.user_temp_team=Number(this.addForm.user_temp_team)
            if(d.examine_status==1){
            	this.EventTempInfo.history = Array.isArray(res.data.examine_key)?res.data.examine_key:JSON.parse(res.data.examine_key);
	            this.examine.examine_summarize = res.data.examine_summarize;
	            this.examine.examine_assess = res.data.examine_assess;
	            this.examine.user_organization_id = JSON.stringify(res.data.organization_id);
//	            this.addForm.id = res.data.user_id;
            }else{
//          	this.examine;
//          	Message({
//            message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
//            // type: 'error',
//            duration: 1500
//          });
            }

//          this.examine.id = res.data.id;
            if(res.data.examine_key==false){
            	this.EventTempInfo.history=[]
            }
//					  this.showDetailDialog = true;
            this.EventTempInfo.status = this.EventTempInfo.history.length > 0 ? 'edit' : 'new';
          } else {
            Message({
              message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
              duration: 1500
            });
          }
        });
      },
      submitAddForm(formName, type) {
    	delete this.addForm.organization_name;
        let aa = this.newUserInfo;
        let _this = this, sendType = 'get', url = this.url;
        // // 需要转换为时间戳的日期字段
        // arr = ['user_birth', 'user_in_date', 'user_become_date'];
        this.$refs[formName].validate((valid) => {
        	//debugger;
          let ids = JSON.parse(JSON.stringify(this.examine.id));
          if (valid) {
            if (type == 'new') {
              sendType = 'post';
            } else if (type == 'edit') {
              sendType = 'put';
              url = url + '/' + ids;
            }
            delete this.examine.id;
//          if (!this.examine.user_id) {
//            Message({
//              message: '请先用身份证搜索个人信息！！！',
//              type: 'warning',
//              duration: 2000
//            });
//            return false;
//          }

            _this.sendData(url, this.examine, sendType, res => {


              if (res.code == 0) {
                Message({
                  message: type == 'new' ? '新增成功！！！' : '修改成功！！！',
                  type: 'success',
                  duration: 1500
                });
                this.showDialog = false;
                this.initForm();
                this.update++;
              }
            });
          }

        });
      },
      /********************* 关键事件记录 start *********************/
      EventAddEdit(type, obj, idx) {
        this.EventTempInfo.show = true;
        this.EventTempInfo.status = type == 'new' ? 'new' : 'edit';
        this.EventTempInfo.index = type == 'new' ? '' : idx;
        this.EventTempInfo.oldData = type == 'new' ? '' : obj;

        this.EventTempInfo.author = type == 'new' ? '' : obj.author;
        this.EventTempInfo.date = type == 'new' ? '' : obj.date;
        this.EventTempInfo.event = type == 'new' ? '' : obj.event;
      },
      EventDel(obj, idx) {
        let arr = JSON.parse(JSON.stringify(this.EventTempInfo.history));
        MessageBox.confirm('您确定删除吗？', '删除', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          arr.forEach((ele, ids) => {
            if (idx == ids && ele.event == obj.event) {
              arr.splice(idx, 1);
            }
          });
          this.EventTempInfo.history = arr;
        });
      },
       //////////////////////////保存按钮///////////////////////////////
      submitEventAdd(obj){
        let _this = this;
        if (this.EventTempInfo.status == 'new') {
          if (!_this.EventTempInfo.author ||
            !_this.EventTempInfo.date ||
            !_this.EventTempInfo.event) {
            Message({
              message: `请填写完整的信息！！！`,
              type: 'warning',
              duration: 1500
            });
            return false;
          }
          this.$nextTick(() => {
            _this.EventTempInfo.history.push({
              author: _this.EventTempInfo.author,
              date: _this.EventTempInfo.date,
              event: _this.EventTempInfo.event,
              showIcon: false,
            });
          });
        } else {
          // this.$nextTick(() => {
          _this.EventTempInfo.history.forEach((ele, idx) => {
            if (idx == this.EventTempInfo.index && ele.event == _this.EventTempInfo.oldData.event) {
              _this.EventTempInfo.history[idx].author = _this.EventTempInfo.author;
              _this.EventTempInfo.history[idx].date = _this.EventTempInfo.date;
              _this.EventTempInfo.history[idx].event = _this.EventTempInfo.event;
              _this.EventTempInfo.history[idx].showIcon = false;
              Vue.set(_this.EventTempInfo.history, idx, _this.EventTempInfo.history[idx]);
            }
          });
          // });

        }
        this.EventTempInfo.show = false;
      },
      /** 编辑账号 **/
      edit(e, d) {
      	
      http.get('/active?user_id='+d.id).then(res => {
				if (res.code == 0) {
						let str=res.data.data;
						let arrr=[]
						for(var i in str){
							arrr.push(str[i].active_name)
						}
						this.huodong=arrr.join(',')
				}else{
					Message({
              message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
              // type: 'error',
              duration: 1500
            });
				}
        });

//				debugger;
//    	console.log(d)

    	this.keys=[]
			//	let _this=this;
			//console.log('hhhh')
				let tree = this.$refs.treeForm;
//				console.log(d)
				//${this.URL}/user/${d.id}
        this.getData(`${this.URL}/user/${d.id}`, '', 'get', res => {
          if (res.code == 0) {
            // 日期转换为时间戳
            res.data = this.dateFontsFiter(this.dateFonts, res.data);
//          debugger
            this.addForm = res.data;
//	          delete this.addForm.organization_name;
						this.addForm.user_temp_team=Number(this.addForm.user_temp_team)
	          //debugger
	          this.addForm.organization_name=res.data.organization_name;
            this.showDialog = true;
            this.dialogTitle = '编辑信息';
            this.dialogType = 'edit';
//						_this.$refs.treeForm.setCheckedKeys([res.data.user_organization_id]);
//						tree.setCurrentKey(res.data.user_organization_id);
//							console.log(res.data.user_organization_id)

							tree.setCheckedKeys([res.data.user_organization_id]);
//							this.keys[0]=res.data.user_organization_id;
//            console.log(this.keys)
//						console.log(res.data.user_organization_id)
          } else {
            Message({
              message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
              // type: 'error',
              duration: 1500
            });
          }
        });
      },
      /** 删除 **/
      delete(e, d) {
        MessageBox.confirm('您确定删除吗？', '删除', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          // 逻辑删除
//        this.sendData(`${this.url}/${d.id}`, {user_status: 3}, 'put', res => {
//					this.sendData("/user/"+d.id, {user_status:3}, 'put', res => {
//          if (res.code == 0) {
//            Message({
//              message: '删除成功！！！',
//              type: 'warning',
//              duration: 1500
//            });
//            this.update++;
//          }
//        });
//           物理删除
             this.sendData(`${this.url}/${d.id}`, '', 'delete', res => {
               if (res.code == 0) {
                 Message({
                   message: '删除成功！！！',
                   // type: 'error',
                   duration: 1500
                 });
                 this.update++;
               }
             });
        })
      },
      /** 取消 **/
      resetAddForm(e, d) {
        this.showDialog = false;
        this.initForm();
      },
      /** 初始化表单 **/
      initForm() {
        this.addForm = {
          id: '',  // int(11) NOT NULL,
          user_name: '',  // varchar(20) DEFAULT '' COMMENT '姓名',
          user_sex: '',  // varchar(20) DEFAULT NULL COMMENT '性别',

          user_nation: '',  // 民族
          user_birth: '',  // varchar(20) DEFAULT NULL COMMENT '出生日期',

          user_card: '',  // varchar(20) DEFAULT NULL COMMENT '身份证',
          user_education: '',  // varchar(20) DEFAULT NULL COMMENT '学历',

          user_address: '',  // 家庭住址
          user_phone: '',  // varchar(20) DEFAULT NULL COMMENT '联系电话',

          user_in_date: '',  // varchar(20) DEFAULT NULL COMMENT '入党日期',
          user_become_date: '',  // varchar(20) DEFAULT NULL COMMENT '转正日期',

          user_dispatched_unit: '',  // varchar(50) DEFAULT NULL COMMENT '派出单位',
          user_origin_unit: '',  // varchar(50) DEFAULT NULL COMMENT '原单位',

          user_temp_team: '',  // varchar(20) DEFAULT NULL COMMENT '保障组别',
          user_job: '',  // varchar(50) DEFAULT NULL COMMENT '党内职务',

          user_origin_organization_name: '',  // varchar(11) DEFAULT NULL '原党组织id',
          user_organization_id: '',  // varchar(11) DEFAULT NULL COMMENT '党组织id',
        };
          this.examine = {
          // CREATE TABLE `examine` (
          id: '', // int(11) NOT NULL AUTO_INCREMENT COMMENT '考评id',
          user_id: '', // int(11) DEFAULT NULL COMMENT '用户id',
          examine_summarize: '', // text COMMENT '个人小结',
          examine_assess: '', // text COMMENT '评价',
          examine_key: '', // text COMMENT '关键事件',
          examine_date: '', // varchar(20) DEFAULT NULL COMMENT '考评日期',
          //     PRIMARY KEY (`id`)
          // ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COMMENT='考评表';
          user_organization_id: '', // 现在临时党组织id
          user_temp_in_date: '',
          user_temp_out_date: '',
        };
        this.EventTempInfo = {
          show: false,  // 是否显示编辑的面板
          status: '',   // new 或者 edit 的状态
          index: '',    // edit 状态下的索引
          oldData: {},  // 编辑前的数据
          // 关键事件记录
          history: [],
          date: '',
          author: '',
          event: '',
          showIcon: false,
        };

      },
      // 确定
      submitAddForm(formName, type) {
				delete this.addForm.organization_name;
        let _this = this, sendType = 'get', url = this.urls.user;
        // // 需要转换为时间戳的日期字段
        // arr = ['user_birth', 'user_in_date', 'user_become_date'];
        this.$refs[formName].validate((valid) => {
          if (valid) {
         // this.addForm.user_organization_id==[]
//    		console.log(this.addForm.user_organization_id);
//    		console.log(Number(_this.$refs.treeForm.getCheckedKeys()));

         // this.addForm.user_organization_id = Number(_this.$refs.treeForm.getCheckedKeys());
          	//console.log(Number(_this.$refs.treeForm.getCheckedKeys()));
            if (type == 'new') {
              sendType = 'post';
              this.addForm.user_organization_id = Number(_this.$refs.treeForm.getCheckedKeys());
//               url = '/account';
            } else if (type == 'edit') {
              sendType = 'put';
              url = url + '/' + _this.addForm.id;
            }
            // 日期转换为时间戳
            this.addForm = this.dateFontsFiter(this.dateFonts, this.addForm);
            delete this.addForm.user_temp_team_name;
            delete this.addForm.examine_id;
						console.log(this.addForm)
//						debugger
            _this.sendData(url, this.addForm, sendType, res => {
              if (res.code == 0) {
                Message({
                  message: type == 'new' ? '新增成功！！！' : '修改成功！！！',
                  type: 'success',
                  duration: 1500
                });
                this.showDialog = false;
                this.initForm();
                this.update++;
              }
            });
          }

        });
      },
      /********************* 关键事件记录 start *********************/
       EventAddEdit(type, obj, idx) {
        this.EventTempInfo.show = true;
        this.EventTempInfo.status = type == 'new' ? 'new' : 'edit';
        this.EventTempInfo.index = type == 'new' ? '' : idx;
        this.EventTempInfo.oldData = type == 'new' ? '' : obj;

        this.EventTempInfo.author = type == 'new' ? '' : obj.author;
        this.EventTempInfo.date = type == 'new' ? '' : obj.date;
        this.EventTempInfo.event = type == 'new' ? '' : obj.event;
      },
      ///////////////确定保存///////////////////////
       submitAddForm1(formName, type) {

//     	console.log(type)
        let aa = this.newUserInfo,obj={};
        let _this = this, sendType = 'get', url = this.url1;
        // // 需要转换为时间戳的日期字段
        // arr = ['user_birth', 'user_in_date', 'user_become_date'];

        this.$refs[formName].validate((valid) => {
//    	debugger
        let ids = JSON.parse(JSON.stringify(this.examine.id));

          if (valid) {
            if (type == 'new') {
              sendType = 'post';
            }else if (type == 'edit') {
//          	let ids =JSON.parse(JSON.stringify(this.examine.id));
              sendType = 'put';
              url = url + '/' + ids;
            }
            delete this.examine.id;
//          if (!this.examine.user_id) {
//            Message({
//              message: '请先用身份证搜索个人信息！！！',
//              type: 'warning',
//              duration: 2000
//            });
//            return false;
//          }
//						console.log(this.addForm.id)
						_this.examine.user_id=this.addForm.id;
						_this.examine.user_organization_id = this.addForm.user_organization_id;
//						this.examine.user_organization_id=this.addForm.organization_id；
						obj = JSON.parse(JSON.stringify(_this.examine));
						obj.examine_key = JSON.parse(obj.examine_key).length==0?'':JSON.parse(obj.examine_key);
						console.log(_this.examine)
//						obj.user_organization_id = '1111111'
//          debugger
//          debugger
//      		delete this.examine.organization_name;
						delete obj.organization_name;


//						debugger
            _this.sendData(url, obj, sendType, res => {
              if (res.code == 0) {
//            	 debugger
                Message({
                  message: type == 'new' ? '新增成功！！！' : '修改成功！！！',
                  type: 'success',
                  duration: 1500
                });
                this.showDialog1 = false;
//				debugger

                this.initForm();
                this.update++;
              }
            });
         }
        });
      },
      // 发送数据
      sendData(url, data, type, call) {
        http.http(url, data, type).then(res => {
          if (typeof(call) == 'function') {
            call(res);
          }
        });
      },
      // 获取数据
      getData(url, data, type, call) {
        http.http(url, data, type).then(res => {
          if (typeof(call) == 'function') {
            call(res);
          }
        });
      },
      /** 时间 转为13位时间戳 **/
      formatTime(time, tar) {
        let t = this.dateformat.timeStamp(time, 13);
        if (tar) {
          this.addForm[tar] = t;
        }
        return t;
      },

      /** 将指定的日期转为时间戳
       * 接收字段名 和 总数据
       * **/
      dateFontsFiter(arr, tar) {
        for (let i in arr) {
          if (typeof(tar[arr[i]]) !== 'number' && isNaN(Number(tar[arr[i]]))) {
            tar[arr[i]] = this.formatTime(tar[arr[i]]);
          } else {
            tar[arr[i]] = this.formatTime(Number(tar[arr[i]]) ? Number(tar[arr[i]]) : '');
          }
        }
        return tar;
      },
    /*********************************** 详情页 *****************************/
      showDetaile(e, d) {
        this.getData(`${this.URL}${this.url}/${d.id}`, '', 'get', res => {
          if (res.code == 0) {
            // 日期转换为时间戳
            this.detailData = JSON.parse(JSON.stringify(res.data));
            this.EventTempInfo.history = JSON.parse(res.data.examine_key);
            this.showDetailDialog = true;
          } else {
            Message({
              message: `获取详情失败，请刷新浏览器！！！ ${res.status}`,
              // type: 'error',
              duration: 1500
            });
          }
        });
      },
      /** 导出功能 **/
      _fileOut(e) {
      //	debugger;
    this.showDetailDialog = true;
       $('#fileExport').wordExport('考评表-' + this.detailData.user_name + '-'+ this.detailData.organization_name);
      },
//     _fileOut(e) {
//      $('#fileExport').execlExport(this.FileOut.title + ' - ' + this.dateformat.format(new Date(), 'yyyy-MM-dd'));
//    },

    }
  }
</script>
<style lang="scss" scoped>
  /** 头部搜索栏 **/
  .review-search {
    margin-top: 0;
  }

  /** 板块 **/
  .review-box {
    margin-bottom: 1.5rem;
    .el-date-editor.el-input, .el-date-editor.el-input__inner {
      width: 100% !important;
    }

  }

  /** 标题栏 **/
  .review-title {
    padding-bottom: 0.2rem;
    border-bottom: 1px solid #aaa;
    margin-bottom: 1rem;
    cursor: default;
    font-size: 1.1rem;
    font-weight: 600;
    font-family: SimHei;
    display: flex;
    justify-content: space-between;
    i {
      color: #cf010c;
      margin-right: 0.2rem;
    }
    .review-right {
      color: #cf010c;
      cursor: pointer;
      font-weight: normal;
      font-size: 1rem;
      padding: 0.1rem 0.5rem;
      border-radius: 0.2rem;
      &:hover {
        background-color: #cf010c;
        color: #fff;
        transition: background-color 0.25s;
      }
      i {
        margin: 0;
        color: inherit;
      }
    }
  }

  /** 关键事件记录 **/
  .event {
    /* 列表 */
    .event-list {
      list-style: none;
      margin: 0;
      padding: 0;
      color: #888;
      strong {
        color: #666;
      }
      li {
        box-sizing: border-box;
        padding: 0.8rem;
        &:hover {
          background-color: #f7f7f7;
          cursor: pointer;
          transition: background-color 0.3s;
        }
      }
      p {
        margin: 0;
      }
      strong {
        display: inline-block;
        width: 4rem;
      }
      /* 小标题 */
      .event-title {
        display: flex;
        justify-content: space-between;
        padding-bottom: 0.8rem;
        .event-title-left {
          display: inherit;
          justify-content: space-between;
          width: 45%;
        }
        .event-icons {
          color: #cf010c;
          i {
            margin: 0 0.1rem;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 3rem;
            &:hover {
              color: #fff;
              background-color: #cf010c;
              transition: background-color 0.25s;
            }
          }
        }
      }
      /* 内容 */
      .event-con {
        display: flex;
        /*justify-content: space-between;*/
        p {
          width: calc(100% - 4rem);
        }
      }
    }
    /* 添加内容的部分 */
    .event-add {
      box-sizing: border-box;
      padding: 0.5rem 0.8rem;
      .event-add-top {
        p {
          display: inline-block;
          strong {
            margin-right: 0.8rem;
          }
          .el-input {
            width: calc(100% - 4rem) !important;
          }
        }
      }
      .event-add-con {
        display: flex;
        align-items: baseline;
        strong {
          margin-right: 1rem;
        }
        .el-textarea {
          width: calc(100% - 4rem);
        }
      }
    }

  }
.file-out {
    position: absolute;
    right: 4rem;
    top: 0.7rem;
  }
  .file-out {
    position: absolute;
    right: 4rem;
    top: 0.7rem;
  }
.moban{
	font-size: 14px;
	color: red;
	/*background: white;*/
	position: absolute;
	/*right: 30px;*/
	right: 20px;
}
.daochu{
	font-size: 14px;
	color: red;
	/*background: white;*/
	position: absolute;
	/*right: 30px;*/
	right: 120px;
}
.qingchu {
  position: absolute;
  /*right:650px;*/
  right: 9%;
  top: 230px;
  height: 34px;
}
</style>

